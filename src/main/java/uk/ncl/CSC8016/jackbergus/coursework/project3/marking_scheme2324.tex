\documentclass{article}

\usepackage[english]{babel}
\usepackage[utf8]{inputenc}
\usepackage{amsmath,amssymb,hyperref}
\usepackage{parskip}
\usepackage{graphicx}

\usepackage{newpxtext,newpxmath}
\usepackage[tagged, highstructure]{accessibility}
% Margins
\usepackage[top=2.5cm, left=3cm, right=3cm, bottom=4.0cm]{geometry}
% Colour table cells
\usepackage[table]{xcolor}

% Get larger line spacing in table
\newcommand{\tablespace}{\\[1.25mm]}
\newcommand\Tstrut{\rule{0pt}{2.6ex}}         % = `top' strut
\newcommand\tstrut{\rule{0pt}{2.0ex}}         % = `top' strut
\newcommand\Bstrut{\rule[-0.9ex]{0pt}{0pt}}   % = `bottom' strut

%%%%%%%%%%%%%%%%%
%     Title     %
%%%%%%%%%%%%%%%%%
\title{Coursework CSC8016}
\author{Giacomo Bergami}
\date{12\textsuperscript{th} of February, 2024}

\begin{document}
	\maketitle
	
	\section*{Use Case Scenario}
We want to implement a forum platform (\texttt{Blog}), where users are opening topic threads for discussions (\texttt{createNewTopicThread}) and posting some comments (\texttt{addPostToThreadId}). When a topic thread is opened, there might be no messages available. We also freely assume that all the users are also moderators, thus allowing to remove specific threads as a whole (\texttt{removeTopicThreadById}). We do not consider the possibility of removing single messages within a topic thread. In addition to this, we might also freely assume that each user might retrieve all the available topic threads names sorted by published date (\texttt{getAllTopics}) as well as their IDs (\texttt{getAllTopicIDs}); a user can also retrieve all messages from a specific topic thread (\texttt{getAllMessagesFromTopic}). Furthermore, the user might be also want to retrieve the latest available update event within the server (\texttt{pollForUpdate}) if available and otherwise wait; an eponymous method also accepting the previous message update as an argument will only return if a new event being different from the one being provided as an argument is effectively generated by one of the users using the platform. When required, the users receive the feedback on their operation's status through either a boolean (true for successful, false for error or unsuccessful) or a \texttt{TopicUpdates} message. The latter class shall not be changed by the student. 

We might freely assume that such platform acts as a monitor, where requests are handled through method invocation. For synchronising read and write operations over the server, the students shall only use the \texttt{ReadWriteMonitorMultiRead} to guarantee the main synchronisation mechanism.


In this scenario, the users should be allowed to perform all of the aforementioned operations concurrently with no race conditions. Using 2PL transactions or ensuring the fairness over reader and writing threads is not strictly required. 
%We want to implement a virtual shopping system, whether the threads are
%either clients using the web app, or clients buying products on the physical shop using the mobile app. The lifecycle of any client interaction is summerised by \texttt{ClientLifecycle}: Each client interacts with the shop through the \texttt{RainforestShop} via the \texttt{login} method, through which each client can add items to its basket and perform re-shelving operations (moving the items back to the physical/virtual shelf from the basket). Each client can get a list of available items at the time of the query, basket a given product by name, (re)shelf the product (thus removing it from the basket), checkout and proceed with the payment (thus either buying all the items on the basket or none of those entirely), and logging out of the system while losing the information of all the items being previously put in the basket from the real/virtual shelf (thus entailing implicit re-shelving).
%
%
%{Each time an allowed user logs in, a non-empty transaction will be created with an unique transaction ID. The unavailability of the product shall be confirmed not while basketing the items, rather than after purchasing those. At this stage, the shop supplier (\texttt{SupplierLifecycle}) might be notified that some products are missing (\texttt{getNextMissingItem}) and refurbish the show with a non-zero amount of products of the same type (\texttt{refurbishWithItems}). For simplicity sake, the \texttt{refurbishWithItems} method will be in charge of creating the number of desired product and to place them on the shelf. }
%
%
%As in any industrial setting where teams split up the duties,
%you are assigned an API that you need to implement. Such an API is provided both on Canvas and at \url{https://github.com/jackbergus/NCL_CSC8016/tree/main/src/main/java/uk/ncl/CSC8016/jackbergus/coursework/project2}. This will then require to finalise the implementation of  \texttt{RainforestShop} and the integration of concurrency mechanisms in \texttt{ProductMonitor}; the \texttt{Transaction} class shall not be changed! The \texttt{Testing} solves a twofold task: showing how Clients, Suppliers, and the Shop system are communicating, as well as providing some preliminary guidelines on how the coursework is going to be assessed. The student is free to choose whichever is the best way to pass the tests (not fully disclosed to the students) in the \texttt{Testing} class. E.g., the RainforestShop could be either modelled as a finer-grained monitor, but inside this monitor at least one thread per logged user should be running; also, such a RainforestShop could be also implemented as a consumer threads handling all of the clients' messages. 
	
	
	\section*{Assumptions}
	\begin{itemize}
		\item In a realistic example, communications happen through restful HTTP requests, and the \texttt{Blog} is actually an HTTP server. In this module, we don't require that. We can freely assume that each user is mimicked by one single
		thread. We assume they directly exploit such an interface (no
		FrontEnd or HTTP requests are required!)

\item The student shall keep the same package structure, as the tests will assume to access the classes within the \texttt{uk.ncl.CSC8016.jackbergus.coursework.project3} package. The students might consider extending the tests for ensure the code correctness. Still, the overall work will be assessed through our provided code, and not theirs!

		\item The students shall freely assume that the main server, \texttt{Blog}, will be an advanced monitor, where an instance of the \texttt{ReadWriteMonitorMultiRead} is going to provide the required \texttt{ReentrantLock} mechanism. 

 \item The student might try to implement such a server as a (multi)\texttt{Thread} service via a thread pool to gain extra points, but this is not strictly required. In this case, the student might freely assume that the thread pool is started  by calling the \texttt{Blog} constructor, and one single thread will stop the thread pool if there is any inactivity for more than 30 seconds. Such pooled threads might receive the client's method invocation as a sequence of ``client messages'' through shared
		variables, where requests need to be handled FIFO. The client will return from its method invocation once the message is handled successfully by one of the threads.
Still, this should require not changing the strict assumption over the API being provided, which should not be by any means changed.
		%\item The RainforestShop already comes with a Transaction class  keeping track of the transactions
		%that are performed for handling basketing operations. You are not required to tolerate the server crash (this is more of
		%a back-up task rather than a concurrent programming one), but
		%you must correcly handle client log outs (withdrawn items from the shelves after log-out should be automatically re-shelved with a cookie-free assumption, where the basket is not ``rembered'' after re-logging in)!
		\item We assume that no user registration, logging, or ban, is given. Additional features going beyond the specifications within the marking scheme will not be evaluated. 
		\item The server should allow the creation of multiple topics with the same name and different and incremental ID \textbf{as far as different timestamps are given to distinguish them}. In order to maximise seriality and concurrency requirements, the students might investigate \textit{optimistic protocols}, thus allowing the concurrent posting across different topic, as this will give the chance to gain extra points.
		\item A solution might be deemed incorrect for the following reasons:
		\begin{enumerate}
		\item Products that were originally basketed cannot be bought any more (e.g., both users attempted to basket a product but only one of them was able to buy it).
	\item The same product name with the same product id cannot be bought multiple times.

		\item Somehow, the computations are ``logically'' correct with single-threaded scenarios, that is \textsf{basket}, \textsf{reshelf}, \textsf{checkout}, and \textsf{logout} implement the expected semantics. Still, this is not sufficient for passing the coursework with full marks. 
		\end{enumerate}
	\end{itemize}
	
	\section*{Submission Requirements}
	\begin{enumerate}
\item To help us with the marking, the students should update the \texttt{studentID} method so to return a string corresponding to their student id. This will help us expediting the marking using our automated tool.
		\item \texttt{Blog} and \texttt{ReadWriteMonitorMultiRead} should be finalised, as the current implementation does not pass the provided tests! The latter class should be used within the former as a main reentrant locking mechamism for the \texttt{Blog} monitor (or thread-pool server). 

The \texttt{TopicUpdates} class 
		\item Submit the code as a zipped \textit{Maven} project via \texttt{File > Export > Project to Zip file\dots} with \textbf{no} \textit{jar} and \textit{classes}. The source code will be recompiled from scratch, and no pre-compiled jar/class is going to be run.
		 
		\item If you want to use an external Java library, please consider the following:
		\begin{itemize}
			\item The Java library should be explicitly described as a \texttt{<dependency>} in the \texttt{pom.xml} file, and should only access the libraries from the default \textit{Maven Central Repository}.
			\item A library might provide single concurrency mechanisms primitives, but not ready-made solutions already composing those: semaphores, monitors, locks, just logs, thread barriers, thread pools, passing le baton mechanisms are allowed. Code reuse from the exercises and examples seen in class is permitted.
			
			\item Systems completely solving the coursework for you are \textbf{strictly prohibited}: e.g., any kind of (data) management system having concurrency control (ensuring safe concurrent thread access to any data representation) and supporting concurrent transactions (implementing any kind of transaction protocol, either pessimistic or optimistic) \textbf{must be avoided}, as they both implement commit/aborts and thread-safe operations on data. 
			\item None of the (direct or indirect) dependencies of the coursework should rely on external servers or processes to run or to be installed.
			\item The solution should \textbf{not} include external jar files.
			\item If unsure whether the solution might be exploited, please ask before submitting.
		\end{itemize}
		 
		\item Attached to the source code, please provide a short report motivating the compliance of the source code to each point and sub-point of the marking scheme. Providing such report in form of comments in the implementation is also fine. New classes might be created for supporting the implementation, but  existing classes should be neither renamed or moved to a different package.
		
	\end{enumerate}


	\section*{Marking Scheme} 
\renewcommand{\labelitemii}{$\blacksquare$}
	The marking scheme is capped at  \textbf{100\%}.
	\begin{itemize}
		\item Single-Thread Correctness \textbf{[+50\%]}
			\begin{description}
			\item [+4\%:] I cannot interact with a blog thread if this was not previously created..
\begin{itemize}
\item You should not be able to remove a non-existing topic thread.
\item You cannot post a comment over a non-existing topic thread.
\item You cannot read the posted messages for a non-existing topic thread.
\end{itemize}
			\item [+16\%:] I can always interact with a topic thread that was previously created.
\begin{itemize}
\item You can create a new topic thread.
\item You can post a message within an existing  topic thread.
\item You can correctly read all the messages in their order of appearance.
\end{itemize}

\item [+4\%:] I am correctly handling the thread closure for an existing topic thread.

\item [+7\%:] I am correctly handling the \texttt{pollForUpdate} method where, if successful requests are always fired before polling for events, should always return the most recent event available.
\begin{itemize}
\item You only retrieve the latest update event.
\item You can correctly detect all the required interaction events of the users over the platform.
\end{itemize}
\item [+3\%:] If no user performs any suitable action, \texttt{pollForUpdate} should pause indefinitely.

\item[+10\%: ] I am correctly handling the \texttt{set} method from \texttt{ReadWriteMonitorMultiRead} (please see the documentation of this method for additional information concerning its expected behaviour).
\item[+6\%: ] I am correctly handling the \texttt{get} method from \texttt{ReadWriteMonitorMultiRead} (please see the documentation of this method for additional information concerning its expected behaviour).




		\end{description}


	\item  Multi-Threaded Correctness \textbf{[+50\%]}
\begin{description}
	\item [+7\%:] The concurrent creation of different topics is handled correctly.
\begin{itemize}
\item Creating multiple topic threads does not raise deadlocks.
\item All the topics requests being sent are fulfilled and available in the exact same order of creation.
\end{itemize}
	\item [+9\%:] The concurrent posting of multiple messages within multiple topic threads is handled correctly.
\begin{itemize}
\item Posting multiple messages across topics or within the same topics does not result into deadlocks.
\item All the messages being sent are fulfilled and available in the exact order of posting.
\end{itemize}
\item [+12\%:] We have one querying user, one moderator user, and eight answering user. Each of those are simulated as distinct threads. The \textit{querying thread} posts the topic and publishes the first comment within the thread; after receiving exactly 8 answers from the answering threads, the querying user posts a thank you message. The \textit{answering threads} are waiting for the first message from the querying user to be posted, after which they provide a reply within the thread. The \textit{moderator thread}  will close all the topics reaching a number of 10 comments.   

\item [+12\%:] While having only one single user running and one subscriber to receive the updates from the website, no interference occurs, and all the perceived events actually match the expected results.
\end{description}


\item  Advanced Features (capped at maximum 10\%):
\begin{itemize}
	\item \textbf{[+1\%]} The program allows to visually determine the correctness of the operations performed by the threads (e.g., terminal prints, engaging with extra tests not provided to the students, or graphical user interfaces).
	\item \textbf{[+1\%]} Any Java library imported via \texttt{pom.xml} `not violating the 3\textsuperscript{rd} Submission Requirement. The following libraries will not be considered, as already provided in the given source code as dependencies: \texttt{annotations} from \texttt{org.jetbrains}, and \texttt{jansi} from \texttt{org.fusesource\-.jansi}.
	\item  \textbf{[+1\%]} Either the methods to be implemented or the extended tests exploit Java's concurrent collections.
\item \textbf{[+1\%]} The student correctly uses \texttt{ReentrantLocks} and \texttt{Conditions} within the \texttt{ReadWrite\-MonitorMultiRead} class.
\item \textbf{[+3\%]} The \texttt{ReadWriteMonitorMultiRead} provides a satisfactory extension of the classical \texttt{ReadWriteMonitor} by not only considering the number of services waiting to read and write a specific latest message update, but also waiting to have a new event being written different from the previously-obtained one. Furthermore, such class is actually used as the only way to deal with read-write operations within \texttt{Blog}, which are also handled correctly.
	\item \textbf{[+1\%]} Thread pools are used to either handle multiple requests from multiple users, or start multiple threads within the extended tests.
	\item  \textbf{[+5\%]} The Blog service is emulated realistically as a separate thread accepting restful requests; this requires the Blog to handle requests one at a time through a queue; Still, the student shall not change the API interface as currently provided.






	%\item \textbf{[+2\%]} The student correctly exploits semaphores.
	%\item \textbf{[+2\%]} The student exploited the optimistic transaction principle, where multiple users can log-in (not only the same user multiple times!).
	%\item \textbf{[+2\%]} Usage of monitors or multithreaded producers and consumers on the interaction with \texttt{Blog} (semaphores might be also exploited).


\end{itemize}
	\end{itemize}


	
\end{document}

